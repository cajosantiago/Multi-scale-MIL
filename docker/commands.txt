# install docker
sudo apt  install docker.io

# install CUDA container toolkit
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
  && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
sudo apt-get update
export NVIDIA_CONTAINER_TOOLKIT_VERSION=1.17.8-1
sudo apt-get install -y \
  nvidia-container-toolkit=${NVIDIA_CONTAINER_TOOLKIT_VERSION} \
  nvidia-container-toolkit-base=${NVIDIA_CONTAINER_TOOLKIT_VERSION} \
  libnvidia-container-tools=${NVIDIA_CONTAINER_TOOLKIT_VERSION} \
  libnvidia-container1=${NVIDIA_CONTAINER_TOOLKIT_VERSION}
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker

cd Multi-scale-Attention-based-MIL
sudo docker build -t mmourao/mmourao:latest ./docker/
sudo docker run --rm --name mariana -it --gpus all mmourao/mmourao python run_inference.py
sudo docker run --rm --name mariana -it -p 7860:7860 --gpus all mmourao/mmourao bash
sudo docker run --rm --name mariana -it -p 7860:7860 --gpus all mmourao/mmourao bash
sudo docker run -d --gpus all --shm-size=16gb -p 7860:7860 -v /mnt/d/code/Multi-scale-MIL/:/home/ --name breast mourao/mourao python gradio_demo.py
apt-get update && apt-get install libgl1 libglib2.0-0
